# Primo.Database.SqlServer

**Primo.Database.SqlServer** is a library designed to simplify working with MS SQL Server databases in a Windows environment. The package addresses tasks related to executing SQL queries and managing database connections, providing developers with a convenient and intuitive interface.

## Installation and Setup

To install the **Primo.Database.SqlServer** package, use the Visual Studio Dependency Manager or download it from [NuGet.org](https://www.nuget.org/).

### Installation via Dependency Manager:

1. **Open the Dependency Manager:**
   - In the main menu of Primo RPA Studio, select `Manage Dependencies`.
   - Or right-click in the project panel and choose `Dependencies` from the context menu.

2. In the opened window, navigate to the **NuGet.org** section and enter **Primo RPA** in the search bar.

3. Click the funnel icon to display the list of available libraries. Find **Primo.Database.SqlServer** and click **Install**.

4. Click **Save** to complete the installation. The package will be added to your project.

## Documentation

More detailed documentation is available on the [Primo RPA website](https://docs.primo-rpa.com).

## Features and Capabilities

Using the "Execute Database Query" element, the library performs the following core functions:

- **Executing SQL queries** with support for named arguments via `@Parameter`.
- **Supporting various database connection types** (Ole DB, PostgreSQL, ODBC).
- **Managing connections**: the ability to use existing connections or configure new ones through element properties.

### Usage Examples

#### Initializing a Connection and Executing SQL Queries with Result Retrieval:

```csharp
LTools.Database.DatabaseApp app = LTools.Database.DatabaseApp.Init(wf, "Provider=SQLOLEDB;Data Source=<servername>;Initial Catalog=<dbname>;Integrated Security=SSPI");
List<List<string>> data = app.Execute("SELECT * FROM Table1", true);
System.Data.DataTable tbl = app.ExecuteQueryTbl("SELECT * FROM Table1");
```
#### Usage Examples in Other Languages:

**Python**

```python
app = LTools.Database.DatabaseApp.Init(
    wf, 
    "Provider=SQLOLEDB;Data Source=<servername>;Initial Catalog=<dbname>;Integrated Security=SSPI"
)
data = app.Execute("SELECT * FROM Table1", True)
tbl = app.ExecuteQueryTbl("SELECT * FROM Table1")
```
**JavaScript**

```javascript
var app = _lib.LTools.Database.DatabaseApp.Init(
    wf, 
    "Provider=SQLOLEDB;Data Source=<servername>;Initial Catalog=<dbname>;Integrated Security=SSPI"
);
var data = app.Execute("SELECT * FROM Table1", true);
var tbl = app.ExecuteQueryTbl("SELECT * FROM Table1");
```
## Library Components

### "Execute Query" Element Properties

1. **Database**:
   
   - **Connection string**: The connection string used to establish a connection to the database. The format of the string depends on the chosen database type and its driver. Examples of connection strings:
     - **Ole DB**:  
       ```plaintext
       "Provider=SQLOLEDB;Data Source=<servername>;Initial Catalog=<dbname>;Integrated Security=SSPI"
       ```
     - **PostgreSQL**:  
       ```plaintext
       "Host=<host>;Port=5432;Password=<password>;Username=<username>;Database=<dbname>"
       ```
     - **ODBC**:  
       ```plaintext
       "DRIVER=<ODBC Driver>; SERVER=<host>; PORT=<port number>;DATABASE=<dbname>; USER=<username>; PASSWORD=<password>"
       ```
     The string can be automatically generated by clicking the ![alt text](image.png) button — this will open a wizard window. The wizard differs for different databases — make sure the DB Type property is filled correctly. 
   - **DB connection**: A variable containing the instance of the database connection. Fill this property if you want to use an already established and active database connection. If you fill in this property, leave the Connection string and DB Type properties empty.
   - **DB type**: The type of the database. Available options:
     - Ole DB (default)
     - PostgreSQL
     - ODBC

2. ## General

- **Continue on exception**: The script will continue running even if an error occurs during the execution of the element.
- **Disable logging**: Allows disabling logging in the console (only for this element). This is useful, for example, if the element handles confidential data. There is also an option to enable/disable logging centrally for all new elements added to the project. To do this, go to File > Settings > General > Elements and set the desired value in the Disable logging for new elements checkbox.
- **Name**: The name of the element, which is displayed in its header and in the log. For convenience, the element name can be changed within the process, for example, when multiple identical components are used.
- **Screenshot on error**: A screenshot will be taken if an error occurs.
- **Screenshot on finish**: Allows taking a screenshot upon the element's completion. All screenshots are saved in the `.Screenshots` folder, which is automatically created inside the process folder.
- **Wait after (ms)**: Pause after the element is executed.
- **Wait before (ms)**: Adds a pause before the element is executed.

3. ## Output

- **Records**: The number of processed rows.
- **Variable (array)**: A variable to store the query results in an array.
- **Variable (table)**: A variable to store the query results in a `DataTable`.

4. ## Query

- **Arguments (array)**: Query arguments in an array format.
- **Arguments (editor)**: Query arguments in string format. The string can be generated in the wizard window by clicking the ![alt text](image-1.png) button. An example of a result from the wizard:
     ```plaintext
     "{\"Args\":[{\"Position\":0,\"Name\":\"@par1\",\"Script\":\"\\\"test\\\"\"}]}"
     ```
   - **Has results**: Indicator of whether query results are expected. Check this if the query is supposed to return data (e.g., `SELECT * FROM table`). If it’s a query like `INSERT INTO` or `DELETE FROM` that does not return data, leave this unchecked..
   - - **Query**: The SQL query text. An example for PostgreSQL:
     ```sql
     "SELECT * FROM table1 WHERE column1 = @par1"
     ```
   - **Time-out**: Query timeout in seconds.

### Работа с аргументами

The argument array (`LTools.Database.Model.ArgumentsModel`) consists of `LTools.Database.Model.ArgumentsModelItem` objects, each of which has the following attributes:

- **Position**: The argument's ordinal number (starting from 0).
- **Name**: The name of the argument.
- **Script**: The value of the argument.

### Argument Usage Examples

1. **Ole DB and ODBC**:

    ```sql
    SELECT * FROM table1 WHERE id > ?
    ```

    The argument will be inserted into the query instead of the `?` symbol according to the specified position. The name of the argument is irrelevant in this case.

2. **PostgreSQL**:

    ```sql
    SELECT * FROM table1 WHERE column1 = @par1
    ```

    During command execution, the argument's name will be replaced with its value.

## Дополнительные материалы

An example RPA project demonstrating the library's functionality is available in our [public repository](https://github.com/PrimoRPA/Learning).

## Feedback

If you have any questions or suggestions, please contact us at [support@primo-rpa.ru](mailto:support@primo-rpa.ru).
